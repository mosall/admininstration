pipeline{
	agent none

    stages{
        stage('build'){
			agent{
				docker{
					image 'node:lts-alpine'
				}
			}
		    steps{
		        sh 'npm install --legacy-peer-deps'
		        sh 'npm run build'
		    }
		}
		stage('Build docker image'){
			agent any 

		    steps{
            script {
                docker.build('cipme-admin')
            }
			}
		}
		stage('Run docker image'){
			agent any
		    steps{
            script {
		          withDockerContainer(args: '-p 86:80', image: 'cipme-admin')
            }
			  }
		}
}
